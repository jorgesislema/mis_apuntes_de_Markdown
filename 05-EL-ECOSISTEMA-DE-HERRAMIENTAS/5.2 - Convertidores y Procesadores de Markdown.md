# Convertidores y Procesadores de Markdown

Los convertidores y procesadores de Markdown son herramientas fundamentales que transforman texto Markdown en otros formatos como HTML, PDF, DOCX, y más. Estas herramientas permiten utilizar Markdown como formato fuente para una amplia variedad de documentos finales, desde páginas web hasta libros electrónicos y documentos académicos.

## Tabla de Contenidos
- [Fundamentos de la conversión de Markdown](#fundamentos-de-la-conversión-de-markdown)
- [Pandoc: El conversor universal](#pandoc-el-conversor-universal)
- [Procesadores específicos de HTML](#procesadores-específicos-de-html)
- [Generadores de PDF](#generadores-de-pdf)
- [Procesadores para documentos académicos](#procesadores-para-documentos-académicos)
- [Conversión a presentaciones](#conversión-a-presentaciones)
- [Conversión a libros y ebooks](#conversión-a-libros-y-ebooks)
- [Herramientas de línea de comandos vs. GUI](#herramientas-de-línea-de-comandos-vs-gui)
- [API y servicios de conversión](#api-y-servicios-de-conversión)
- [Extensiones y plugins de procesamiento](#extensiones-y-plugins-de-procesamiento)
- [Ejercicios prácticos](#ejercicios-prácticos)

---

## Fundamentos de la conversión de Markdown

### El proceso de conversión

La conversión de Markdown a otros formatos sigue típicamente estos pasos:

1. **Análisis (parsing)**: Conversión del texto Markdown a una estructura de datos interna (AST - Abstract Syntax Tree)
2. **Transformación**: Manipulación opcional del AST (añadir metadatos, procesar extensiones)
3. **Renderizado**: Generación del formato de salida (HTML, PDF, DOCX, etc.)

### Arquitectura común

```
+-------------+    +-----------+    +--------------+
| Documento   |    | AST       |    | Documento    |
| Markdown    | -> | Intermedio | -> | Convertido   |
| (input.md)  |    |           |    | (output.xxx) |
+-------------+    +-----------+    +--------------+
      ^                 ^                  ^
      |                 |                  |
   Parser           Transformers       Renderers
```

### Componentes de un procesador

| Componente | Función |
|-----------|---------|
| **Parser** | Interpreta la sintaxis Markdown y crea una representación estructurada |
| **AST** | Estructura de datos que representa el documento jerárquicamente |
| **Transformers** | Modifican el AST (ej: añadir TOC, procesar extensiones) |
| **Renderers** | Convierten el AST al formato de salida |
| **Extensions** | Añaden funcionalidad a la sintaxis básica (tablas, notas al pie, etc.) |

---

## Pandoc: El conversor universal

![Pandoc](https://pandoc.org/diagram.jpg)

Pandoc es considerado el "navaja suiza" de la conversión documental, capaz de transformar entre múltiples formatos, con Markdown como formato pivote central.

### Instalación

**Windows (con Chocolatey):**
```powershell
choco install pandoc
```

**macOS (con Homebrew):**
```bash
brew install pandoc
```

**Linux (Debian/Ubuntu):**
```bash
sudo apt-get install pandoc
```

### Conversiones básicas

**Markdown a HTML:**
```bash
pandoc -f markdown -t html documento.md -o documento.html
```

**Markdown a PDF (requiere LaTeX):**
```bash
pandoc documento.md -o documento.pdf
```

**Markdown a Word:**
```bash
pandoc -f markdown -t docx documento.md -o documento.docx
```

**Markdown a presentación:**
```bash
pandoc -t revealjs -s presentacion.md -o presentacion.html
```

### Opciones avanzadas

```bash
# Con tabla de contenido y numeración
pandoc --toc --number-sections documento.md -o documento.html

# Con estilos CSS personalizados
pandoc -c estilos.css documento.md -o documento.html

# Con plantilla personalizada
pandoc --template=plantilla.html documento.md -o documento.html

# Con bibliografía y citas
pandoc --bibliography=referencias.bib --citeproc documento.md -o documento.html
```

### Extensiones de Markdown en Pandoc

Pandoc soporta varias extensiones de Markdown, controlables mediante la sintaxis `markdown+EXTENSION` o `markdown-EXTENSION`:

```bash
# Habilitar tablas y notas al pie, deshabilitar énfasis con guiones bajos
pandoc -f markdown+tables+footnotes-implicit_figures documento.md -o output.html
```

Extensiones populares:
- `footnotes`: Notas al pie
- `tables`: Tablas
- `definition_lists`: Listas de definiciones
- `fenced_code_blocks`: Bloques de código cercados
- `yaml_metadata_block`: Bloques YAML de metadatos
- `auto_identifiers`: IDs automáticos para encabezados

---

## Procesadores específicos de HTML

### Marked

Una librería JavaScript para convertir Markdown a HTML.

**Uso básico:**
```javascript
const marked = require('marked');
const html = marked('# Título\nUn párrafo con **texto en negrita**.');
```

**Opciones personalizadas:**
```javascript
marked.setOptions({
  renderer: new marked.Renderer(),
  highlight: function(code, language) {
    const hljs = require('highlight.js');
    const validLanguage = hljs.getLanguage(language) ? language : 'plaintext';
    return hljs.highlight(validLanguage, code).value;
  },
  pedantic: false,
  gfm: true,
  breaks: false,
  sanitize: false,
  smartLists: true,
  smartypants: false,
  xhtml: false
});
```

### Markdown-it

Otro parser popular de JavaScript con sistema de plugins.

**Uso básico:**
```javascript
const MarkdownIt = require('markdown-it');
const md = new MarkdownIt();
const html = md.render('# Markdown-it\n**Texto** en *Markdown*.');
```

**Con plugins:**
```javascript
const md = new MarkdownIt()
  .use(require('markdown-it-footnote'))
  .use(require('markdown-it-table-of-contents'))
  .use(require('markdown-it-anchor'));

const html = md.render(contenido);
```

### Showdown

Conversor bidireccional JavaScript (Markdown ↔ HTML).

**Uso básico:**
```javascript
const showdown = require('showdown');
const converter = new showdown.Converter();
const html = converter.makeHtml('# Hola\nMundo en **Markdown**.');
const markdown = converter.makeMarkdown('<h1>Hola</h1><p>Mundo en <strong>HTML</strong>.</p>');
```

---

## Generadores de PDF

### Pandoc + LaTeX

El enfoque más potente para PDF de calidad profesional:

```bash
# Instalación de LaTeX (en Debian/Ubuntu)
sudo apt-get install texlive-latex-base texlive-fonts-recommended texlive-fonts-extra texlive-latex-extra

# Conversión básica
pandoc documento.md -o documento.pdf

# Con opciones avanzadas
pandoc documento.md --pdf-engine=xelatex -V geometry:margin=1in -o documento.pdf
```

Opciones comunes para PDF:
- `--pdf-engine=xelatex`: Mejor soporte para Unicode
- `-V geometry:margin=1in`: Ajuste de márgenes
- `-V fontsize=12pt`: Tamaño de fuente
- `-V documentclass=report`: Clase de documento

### Markdown-pdf

Biblioteca Node.js para convertir Markdown a PDF usando Chromium/Puppeteer:

```javascript
const markdownpdf = require('markdown-pdf');
const fs = require('fs');

fs.createReadStream('documento.md')
  .pipe(markdownpdf())
  .pipe(fs.createWriteStream('documento.pdf'));
```

Ventajas:
- No requiere LaTeX
- Utiliza CSS para estilos
- Consistencia con renderizado web

### WeasyPrint + md2html

Enfoque de dos pasos usando primero conversión a HTML y luego HTML a PDF:

```bash
# Convertir Markdown a HTML
pandoc documento.md -o temp.html

# Convertir HTML a PDF con WeasyPrint
weasyprint temp.html documento.pdf
```

Ventajas:
- Control preciso con CSS
- No requiere LaTeX
- Buena compatibilidad con características web modernas

---

## Procesadores para documentos académicos

### R Markdown

R Markdown combina código R con Markdown para documentos reproducibles:

```r
---
title: "Análisis estadístico"
author: "Nombre Autor"
date: "2025-07-07"
output:
  pdf_document:
    toc: true
    number_sections: true
---

# Introducción

Este es un análisis de los datos `mtcars`.

```{r, fig.width=8, fig.height=6}
data(mtcars)
plot(mtcars$wt, mtcars$mpg, 
     main="Peso vs Consumo", 
     xlab="Peso (1000 lbs)", 
     ylab="Millas por galón")
```

Como podemos observar, existe una correlación negativa entre peso y consumo.
```

Características:
- Integración de código y resultados
- Generación de gráficos
- Múltiples formatos de salida
- Gestión de referencias

### Quarto

Evolución de R Markdown compatible con múltiples lenguajes:

```markdown
---
title: "Documento Quarto"
format:
  html:
    toc: true
    code-fold: true
  pdf:
    toc: true
    number-sections: true
  docx: default
---

# Introducción

Podemos ejecutar código en Python:

```{python}
import matplotlib.pyplot as plt
import numpy as np

x = np.linspace(0, 10, 100)
y = np.sin(x)
plt.plot(x, y)
plt.title("Función Seno")
plt.show()
```

Y también en R:

```{r}
plot(cars, main="Velocidad vs. Distancia de frenado")
```
```

Ventajas:
- Soporte para Python, R, Julia, Observable JS
- Múltiples formatos de salida
- Sistema extensible

### Pandoc Scholarly

Extensión de Pandoc optimizada para publicaciones académicas:

```bash
pandoc-scholar documento.md --bibliography=referencias.bib --csl=ieee.csl -o documento.pdf
```

Características:
- Plantillas para artículos científicos
- Gestión avanzada de metadatos
- Soporte para múltiples estilos bibliográficos
- Generación de PDF académicos

---

## Conversión a presentaciones

### Reveal.js con Pandoc

Conversión de Markdown a presentaciones HTML interactivas:

```markdown
---
title: "Mi Presentación"
author: "Nombre"
date: "2025-07-07"
output: 
  revealjs::revealjs_presentation:
    theme: sky
    highlight: zenburn
    transition: slide
---

# Primera Diapositiva

Contenido de la primera diapositiva

---

## Segunda Diapositiva

- Punto 1
- Punto 2
- Punto 3

---

![Imagen](imagen.jpg)

---

```{r, echo=TRUE}
# Código R
plot(cars)
```
```

Comando para conversión:
```bash
pandoc -t revealjs -s presentacion.md -o presentacion.html
```

### Marp

Markdown Presentation Ecosystem:

```markdown
---
marp: true
theme: default
paginate: true
---

# Mi Presentación con Marp

---

## Diapositiva 2

Contenido con *formato*

![bg right:40%](imagen.jpg)

---

## Código

```python
def hola():
    print("¡Hola mundo!")
```
```

Ventajas:
- Editor WYSIWYG disponible
- Temas incorporados y personalizables
- Exportación a PDF, PPTX
- VS Code plugin disponible

### DeckSet (macOS)

Aplicación nativa para macOS que convierte Markdown a presentaciones:

```markdown
# [fit] Título Principal
## Subtítulo

---

# Segunda Diapositiva

- Punto 1
- Punto 2

[.column]

![](imagen.jpg)

---

# Código

```python
print("Hola Mundo")
```

^ Notas del presentador que no aparecen en pantalla
```

Características:
- WYSIWYG en tiempo real
- Múltiples temas
- Sintaxis simple
- Exportación a PDF

---

## Conversión a libros y ebooks

### Pandoc para EPUB

```bash
pandoc -o libro.epub titulo.txt capitulos/*.md
```

Opciones comunes:
- `--epub-cover-image=portada.jpg`: Añadir portada
- `--toc-depth=2`: Profundidad de la tabla de contenidos
- `--epub-metadata=metadata.xml`: Metadatos del libro
- `--css=estilo.css`: Estilos personalizados

### Mdbook

Crea libros con Markdown y Rust:

Estructura:
```
book/
├── book.toml
└── src/
    ├── SUMMARY.md
    ├── chapter_1.md
    ├── chapter_2.md
    └── chapter_3.md
```

SUMMARY.md:
```markdown
# Sumario

- [Introducción](README.md)
- [Capítulo 1](chapter_1.md)
- [Capítulo 2](chapter_2.md)
    - [Sección 2.1](chapter_2/section_1.md)
- [Capítulo 3](chapter_3.md)
```

Comandos:
```bash
# Instalar mdbook
cargo install mdbook

# Iniciar nuevo libro
mdbook init mi_libro

# Construir libro
mdbook build

# Servidor de desarrollo
mdbook serve --open
```

### Bookdown

R package para escribir libros con R Markdown:

```yaml
---
title: "Mi Libro con Bookdown"
author: "Autor"
date: "2025-07-07"
site: bookdown::bookdown_site
documentclass: book
bibliography: [libro.bib, paquetes.bib]
biblio-style: apalike
link-citations: yes
---
```

Características:
- Referenciación cruzada automática
- Gestión de bibliografía
- Múltiples formatos de salida (HTML, PDF, EPUB)
- Numeración automática de figuras, tablas y ecuaciones

---

## Herramientas de línea de comandos vs. GUI

### Herramientas CLI populares

| Herramienta | Foco | Ventajas |
|------------|------|----------|
| **Pandoc** | Conversión universal | Versatilidad, opciones avanzadas |
| **Kramdown** | Parser Ruby | Integración con Jekyll |
| **cmark** | Parser C | Alto rendimiento, compatibilidad CommonMark |
| **lowdown** | Parser C | Ligero, optimizado |
| **multimarkdown** | Extensiones | Tablas, notas, metadatos |

### Interfaces gráficas

| Herramienta | Plataforma | Características |
|------------|-----------|----------------|
| **Typora** | Win/Mac/Linux | WYSIWYG, exportación integrada |
| **Marked 2** | macOS | Vista previa, exportación avanzada |
| **Texts** | Win/Mac | WYSIWYG, exportación Pandoc |
| **ghostwriter** | Win/Linux | Vista previa, exportación integrada |
| **Zettlr** | Win/Mac/Linux | Académico, exportación múltiple |

### Cuándo usar CLI vs. GUI

**Ventajas de CLI:**
- Automatización mediante scripts
- Procesamiento por lotes
- Integración en pipelines de CI/CD
- Control preciso sobre opciones

**Ventajas de GUI:**
- Vista previa en tiempo real
- Curva de aprendizaje más suave
- Configuración visual
- Mejor para usuarios no técnicos

---

## API y servicios de conversión

### API de conversión

#### Markdown-it como servicio:

```javascript
const express = require('express');
const MarkdownIt = require('markdown-it');
const app = express();
const md = new MarkdownIt();

app.use(express.json());

app.post('/convert', (req, res) => {
  const markdown = req.body.markdown;
  
  if (!markdown) {
    return res.status(400).json({ error: 'No markdown provided' });
  }
  
  const html = md.render(markdown);
  res.json({ html });
});

app.listen(3000, () => {
  console.log('Conversion API running on port 3000');
});
```

#### API con opciones avanzadas:

```javascript
app.post('/convert', (req, res) => {
  const { markdown, options } = req.body;
  
  if (!markdown) {
    return res.status(400).json({ error: 'No markdown provided' });
  }
  
  // Configurar opciones
  const mdInstance = new MarkdownIt({
    html: options?.html || false,
    linkify: options?.linkify || true,
    typographer: options?.typographer || true
  });
  
  // Añadir plugins según opciones
  if (options?.footnotes) {
    mdInstance.use(require('markdown-it-footnote'));
  }
  
  if (options?.toc) {
    mdInstance.use(require('markdown-it-table-of-contents'));
  }
  
  const html = mdInstance.render(markdown);
  res.json({ html });
});
```

### Servicios en la nube

#### Servicio de conversión serverless:

```javascript
// AWS Lambda function
exports.handler = async (event) => {
  const MarkdownIt = require('markdown-it');
  const md = new MarkdownIt();
  
  try {
    const body = JSON.parse(event.body);
    const markdown = body.markdown;
    
    if (!markdown) {
      return {
        statusCode: 400,
        body: JSON.stringify({ error: 'No markdown provided' })
      };
    }
    
    const html = md.render(markdown);
    
    return {
      statusCode: 200,
      body: JSON.stringify({ html })
    };
  } catch (error) {
    return {
      statusCode: 500,
      body: JSON.stringify({ error: error.message })
    };
  }
};
```

---

## Extensiones y plugins de procesamiento

### Sistema de plugins de Markdown-it

```javascript
const md = require('markdown-it')()
  // Habilitar resaltado de código
  .use(require('markdown-it-highlightjs'))
  
  // Añadir soporte para notas al pie
  .use(require('markdown-it-footnote'))
  
  // Añadir anclas a los encabezados
  .use(require('markdown-it-anchor'), {
    permalink: true,
    permalinkSymbol: '§',
    permalinkBefore: true
  })
  
  // Añadir tabla de contenidos
  .use(require('markdown-it-table-of-contents'), {
    includeLevel: [1, 2, 3],
    containerClass: 'table-of-contents',
    slugify: s => encodeURIComponent(s.toLowerCase().replace(/\s+/g, '-'))
  });

const html = md.render(markdown);
```

### Plugins populares para procesadores

| Plugin | Función | Compatible con |
|-------|---------|----------------|
| **markdown-it-anchor** | Anclas en encabezados | markdown-it |
| **markdown-it-toc** | Tabla de contenidos | markdown-it |
| **markdown-it-footnote** | Notas al pie | markdown-it |
| **markdown-it-container** | Bloques personalizados | markdown-it |
| **remark-gfm** | GitHub Flavored Markdown | remark |
| **remark-math** | Fórmulas matemáticas | remark |
| **remark-lint** | Linter para Markdown | remark |
| **rehype-highlight** | Resaltado de código | rehype |
| **rehype-katex** | Renderizado de matemáticas | rehype |

### Desarrollo de plugins personalizados

#### Plugin markdown-it simple:

```javascript
function miPlugin(md) {
  // Reemplaza !!texto!! con <mark>texto</mark>
  md.inline.ruler.after('emphasis', 'mark', function(state, silent) {
    let start = state.pos;
    
    if (state.src.charAt(start) !== '!') { return false; }
    if (state.src.charAt(start + 1) !== '!') { return false; }
    
    let marker = state.src.charAt(start);
    let pos = start + 2;
    let found = false;
    
    while (pos < state.posMax) {
      if (state.src.charAt(pos) === '!' && 
          state.src.charAt(pos + 1) === '!') {
        found = true;
        break;
      }
      pos++;
    }
    
    if (!found) { return false; }
    
    // No renderizar si es solo un análisis
    if (silent) { return true; }
    
    let token = state.push('mark_open', 'mark', 1);
    token = state.push('text', '', 0);
    token.content = state.src.slice(start + 2, pos);
    token = state.push('mark_close', 'mark', -1);
    
    state.pos = pos + 2;
    return true;
  });
}

// Uso
const md = require('markdown-it')().use(miPlugin);
console.log(md.render('Esto es !!texto resaltado!!'));
// Salida: <p>Esto es <mark>texto resaltado</mark></p>
```

---

## Ejercicios prácticos

### Ejercicio 1: Conversión básica con Pandoc

Crea un documento Markdown y conviértelo a múltiples formatos:

1. Instala Pandoc
2. Crea un documento `documento.md` con diferentes elementos Markdown
3. Conviértelo a HTML: `pandoc documento.md -o documento.html`
4. Conviértelo a PDF: `pandoc documento.md -o documento.pdf`
5. Conviértelo a DOCX: `pandoc documento.md -o documento.docx`
6. Compara los resultados en diferentes formatos

### Ejercicio 2: Presentación con Markdown

Crea una presentación desde Markdown:

1. Crea un archivo `presentacion.md` con diapositivas separadas por `---`
2. Incluye elementos como:
   - Títulos y listas
   - Imágenes
   - Bloques de código
   - Citas
3. Genera una presentación HTML con Reveal.js:
   ```bash
   pandoc -t revealjs -s presentacion.md -o presentacion.html
   ```
4. Personaliza la presentación con temas y transiciones

### Ejercicio 3: Documento académico con referencias

Crea un documento académico con referencias bibliográficas:

1. Crea un documento `articulo.md` con estructura académica
2. Crea un archivo `referencias.bib` con entradas BibTeX
3. Añade citas en tu documento usando `[@clave]`
4. Genera un PDF académico:
   ```bash
   pandoc articulo.md --bibliography=referencias.bib --citeproc --pdf-engine=xelatex -o articulo.pdf
   ```
5. Experimenta con diferentes estilos de citación (APA, IEEE, etc.)

---

## Recursos adicionales

- [Pandoc User Guide](https://pandoc.org/MANUAL.html) - Documentación oficial y completa
- [Markdown-it Demo](https://markdown-it.github.io/) - Prueba interactiva de markdown-it
- [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/) - Guía completa de R Markdown
- [Quarto Guide](https://quarto.org/docs/guide/) - Documentación de Quarto
- [MkDocs Material](https://squidfunk.github.io/mkdocs-material/) - Extensiones para MkDocs
- [LaTeX for Pandoc](https://pandoc.org/MANUAL.html#creating-a-pdf) - Opciones para PDF con Pandoc

---

**Siguiente**: [Extensiones y Plugins para Markdown](5.3%20-%20Extensiones%20y%20Plugins%20para%20Markdown.md)

**Tiempo de lectura**: 30 minutos  
**Nivel**: Intermedio-Avanzado  
**Prerrequisitos**: Conocimiento básico de Markdown y línea de comandos
